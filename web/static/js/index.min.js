function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}var slice$=[].slice;!function(){var e,n,t;if(e=function(e,n,t){return null==n&&(n={}),null==t&&(t={}),new Promise(function(r,o){var i;return i=new XMLHttpRequest,i.onreadystatechange=function(){var e,n;if(i.readyState===XMLHttpRequest.DONE){if(200===i.status){try{e="json"===t.type?JSON.parse(i.responseText):i.responseText}catch(e){return n=e,o(new Error(n))}return r(e)}return o(new Error)}},i.onloadstart=function(){return t.progress({percent:0,val:0,len:0})},t.progress&&(i.onprogress=function(e){var n,r,o;return n=[e.loaded,e.total],r=n[0],o=n[1],t.progress({percent:r/o,val:r,len:o})}),i.open(n.method||"GET",e,!0),i.send(n.body)})},n=function(e){var n=this;return null==e&&(e={}),this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.evtHandler={},this.opt=e,this.ucfg=e.uploader||{route:"/d/uploadr",host:"native"},this.progress=function(e){var t,r;if((t=(e.item||(e.item={})).node)&&(r=ld$.find(t,"[ld=progress]")[0]))return r.style.width=100*e.percent+"%",e.percent>=1?debounce(500).then(function(){var r;if(ld$.remove(t),~(r=n.lc.files.indexOf(e.item)))return n.lc.files.splice(r,1)}):void 0},this.lc={files:[]},this.init(),this},n.prototype=import$(Object.create(Object.prototype),{on:function(e,n){var t;return((t=this.evtHandler)[e]||(t[e]=[])).push(n)},fire:function(e){var n,t,r,o,i,u=[];for(n=slice$.call(arguments,1),t=0,o=(r=this.evtHandler[e]||[]).length;t<o;++t)i=r[t],u.push(i.apply(this,n));return u},init:function(){var e,n,t=this;return e=this.lc,this.lc.view=n=new ldView({root:this.root,action:{click:{upload:function(e){return e.node,e.evt,t.upload().then(function(e){return t.clear(),e})},clear:function(e){return e.node,e.evt,t.clear()}},drop:{drop:function(r){var o,i;return r.node,(o=r.evt).preventDefault(),i=Array.from(o.dataTransfer.files).map(function(e){return ldFile.fromFile(e,"dataurl","utf-8")}),Promise.all(i).then(function(r){return e.files=r,n.render(),t.upload().then(function(e){return t.clear(),e})})}},dragover:{drop:function(e){return e.node,e.evt.preventDefault()}}},init:{input:function(r){var o,i;return o=r.node,e.ldf=i=new ldFile({root:o,type:"dataurl",forceEncoding:"utf-8"}),o.addEventListener("change",function(){return t.fire("preview.loading")}),i.on("load",function(r){var o,i;return o=n.get("preview"),i=r.map(function(e){return new Promise(function(n,t){var i;return i=new Image,i.onload=function(){var t,u;return o&&((t=o.style).backgroundImage="url("+r[0].result+")",t.width=i.width+"px",t.height=i.height+"px"),n(import$((u={},u.width=i.width,u.height=i.height,u),e))},i.src=e.result})}),Promise.all(i).then(function(){return e.files=r,debounce(500)}).then(function(){return n.render(),t.fire("preview.done")})})}},handler:{file:{list:function(){return e.files||[]},handle:function(n){var t,r;return t=n.node,r=n.data,r.node=t,new ldView({root:t,action:{click:{delete:function(){var n;if(t.parentNode.removeChild(t),(n=e.files.indexOf(r))>=0)return e.files.splice(n,1)}}},handler:{name:function(e){var n;return n=e.node,n.textContent=r.file.name},size:function(e){var n;return n=e.node,n.textContent=Math.round(r.file.size/1024)+"KB"},thumb:function(e){var n;return n=e.node,n.style.backgroundImage="url("+r.result+")"}}})}}}})},get:function(){return this.lc.files},clear:function(){return this.lc.files.splice(0),this.lc.view.render()},upload:function(){var e=this;return t[this.ucfg.host]({files:this.lc.files,progress:this.progress,opt:this.ucfg}).then(function(n){return e.fire("upload.done",n),n}).catch(function(n){return e.fire("upload.fail",n),Promise.reject(n)})}}),t={},t.dummy=function(e){var n;return n=e.files,e.progress,e.opt,new Promise(function(e,t){return e(n.map(function(e){return{url:"https://i.ibb.co/frf90x6/only-support.png",name:e.file.name}}))})},t.native=function(n){var t,r,o;return t=n.files,r=n.progress,o=n.opt,new Promise(function(n,i){var u,a,l,s,c,f,d;return u=o||{},a=u.merge,l=u.route,r({percent:0,val:0,len:f}),a?(s=new FormData,t.map(function(e){return s.append("file",e.file)}),e(l,{method:"POST",body:s},{type:"json"}).then(n).catch(i)):(c=[],f=t.length,(d=function(t){var o,i;return(o=t.splice(0,1)[0])?((i=new FormData).append("file",o.file),e(l,{method:"POST",body:i},{type:"json",progress:function(e){return r((e.item=o,e))}}).then(function(e){return c.push(e[0]),d(t)}).catch(function(e){return c.push({name:o.file.name,error:e})})):n(c)})(t))})},t.imgbb=function(n){var t,r,o;return t=n.files,r=n.progress,o=n.opt,new Promise(function(n,i){var u,a,l;return u=[],a=t.length,r({percent:0,val:0,len:a}),(l=function(t){var i,s;return(i=t.splice(0,1)[0])?((s=new FormData).append("image",i.file),e("https://api.imgbb.com/1/upload?key="+o.key,{method:"POST",body:s},{type:"json"}).then(function(e){var n;return e&&e.data&&200===e.status?(u.push(n={url:e.data.display_url,name:i.file.name,id:e.data.id,raw:e.data}),r({percent:(a-t.length)/a,val:a-t.length,len:a,item:n}),l(t)):Promise.reject(e)}).catch(function(e){var n;return u.push(n={name:i.file.name,error:e}),r({percent:(a-t.length)/a,val:a-t.length,len:a,item:n})})):n(u)})(t)})},"undefined"!=typeof module&&null!==module&&(module.exports=n),"undefined"!=typeof window&&null!==window)window.uploadr=n}();