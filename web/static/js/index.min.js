function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var slice$=[].slice;!function(){var e,t;if(e=function(e){return null==e&&(e={}),this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.evtHandler={},this.opt=e,this.ucfg=e.uploader||{route:"/d/uploadr",host:"native"},this.progress=e.progress||function(){},this.lc={files:[]},this.init(),this},e.prototype=import$(Object.create(Object.prototype),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){var t,n,r,o,i,u=[];for(t=slice$.call(arguments,1),n=0,o=(r=this.evtHandler[e]||[]).length;n<o;++n)i=r[n],u.push(i.apply(this,t));return u},init:function(){var e,t,n=this;return e=this.lc,this.lc.view=t=new ldView({root:this.root,action:{click:{upload:function(e){return e.node,e.evt,n.upload().then(function(e){return n.clear(),e})},clear:function(e){return e.node,e.evt,n.clear()}},drop:{drop:function(n){var r,o;return n.node,(r=n.evt).preventDefault(),o=Array.from(r.dataTransfer.files).map(function(e){return ldFile.fromFile(e,"dataurl","utf-8")}),Promise.all(o).then(function(n){return e.files=n,t.render(),uploads({files:e.files,progress:function(e){return console.log(e)}})})}},dragover:{drop:function(e){return e.node,e.evt.preventDefault()}}},handler:{file:{list:function(){return e.files||[]},handle:function(t){var n,r;return n=t.node,r=t.data,new ldView({root:n,action:{click:{delete:function(){var t;if(n.parentNode.removeChild(n),(t=e.files.indexOf(r))>=0)return e.files.splice(t,1)}}},handler:{name:function(e){var t;return t=e.node,t.textContent=r.file.name},size:function(e){var t;return t=e.node,t.textContent=Math.round(r.file.size/1024)+"KB"},thumb:function(e){var t;return t=e.node,t.style.backgroundImage="url("+r.result+")"}}})}},input:function(n){var r,o;return r=n.node,e.ldf=o=new ldFile({root:r,type:"dataurl",forceEncoding:"utf-8"}),o.on("load",function(n){var r,o;return r=t.get("preview"),o=n.map(function(e){return new Promise(function(t,o){var i;return i=new Image,i.onload=function(){var o,u;return r&&((o=r.style).backgroundImage="url("+n[0].result+")",o.width=i.width+"px",o.height=i.height+"px"),t(import$((u={},u.width=i.width,u.height=i.height,u),e))},i.src=e.result})}),Promise.all(o).then(function(){return e.files=n,t.render()})})}}})},get:function(){return this.lc.files},clear:function(){return this.lc.files.splice(0),this.lc.view.render()},upload:function(){var e=this;return t[this.ucfg.host]({files:this.lc.files,progress:this.progress,opt:this.ucfg}).then(function(t){return e.fire("upload.done",t),t}).catch(function(t){return e.fire("upload.fail",t),Promise.reject(t)})}}),t={},t.dummy=function(e){var t;return t=e.files,e.progress,e.opt,new Promise(function(e,n){return e(t.map(function(e){return{url:"https://i.ibb.co/frf90x6/only-support.png",name:e.file.name}}))})},t.native=function(e){var t,n,r;return t=e.files,n=e.progress,r=e.opt,new Promise(function(e,o){var i,u,l,a,c,f,s;return i=r||{},u=i.merge,l=i.route,n({v:0,count:0,len:f}),u?(a=new FormData,t.map(function(e){return a.append("file",e.file)}),ld$.fetch(l,{method:"POST",body:a},{type:"json"}).then(e).catch(o)):(c=[],f=t.length,(s=function(t){var r,o;return(r=t.splice(0,1)[0])?((o=new FormData).append("file",r.file),ld$.fetch(l,{method:"POST",body:o},{type:"json"}).then(function(e){var r;return c.push(r=e[0]),n({v:(f-t.length)/f,count:f-t.length,len:f,item:r}),s(t)}).catch(function(e){var o;return c.push(o={name:r.file.name,error:e}),n({v:(f-t.length)/f,count:f-t.length,len:f,item:o})})):e(c)})(t))})},t.imgbb=function(e){var t,n,r;return t=e.files,n=e.progress,r=e.opt,new Promise(function(e,o){var i,u,l;return i=[],u=t.length,n({v:0,count:0,len:u}),(l=function(t){var o,a;return(o=t.splice(0,1)[0])?((a=new FormData).append("image",o.file),ld$.fetch("https://api.imgbb.com/1/upload?key="+r.key,{method:"POST",body:a},{type:"json"}).then(function(e){var r;return e&&e.data&&200===e.status?(i.push(r={url:e.data.display_url,name:o.file.name,id:e.data.id,raw:e.data}),n({v:(u-t.length)/u,count:u-t.length,len:u,item:r}),l(t)):Promise.reject(e)}).catch(function(e){var r;return i.push(r={name:o.file.name,error:e}),n({v:(u-t.length)/u,count:u-t.length,len:u,item:r})})):e(i)})(t)})},"undefined"!=typeof module&&null!==module&&(module.exports=e),"undefined"!=typeof window&&null!==window)window.uploadr=e}();