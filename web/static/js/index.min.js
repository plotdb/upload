function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}var slice$=[].slice;!function(){var e,n,t;if(e=function(n,t,r){return null==t&&(t={}),null==r&&(r={}),new Promise(function(o,i){var u;return u=new XMLHttpRequest,u.onreadystatechange=function(){var n,t;if(e.readyState===XMLHttpRequest.DONE){if(200===e.status){try{n="json"===r.type?JSON.parse(e.responseText):e.responseText}catch(e){return t=e,i(new Error(t))}return o(n)}return i(new Error)}},u.onloadstart=function(){return r.progress({percent:0,val:0,len:0})},r.progress&&(u.onprogress=function(e){var n,t,o;return n=[e.loaded,e.total],t=n[0],o=n[1],r.progress({percent:t/o,val:t,len:o})}),u.open(t.method||"GET",n,!0),u.send(t.body)})},n=function(e){return null==e&&(e={}),this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.evtHandler={},this.opt=e,this.ucfg=e.uploader||{route:"/d/uploadr",host:"native"},this.progress=e.progress||function(){},this.lc={files:[]},this.init(),this},n.prototype=import$(Object.create(Object.prototype),{on:function(e,n){var t;return((t=this.evtHandler)[e]||(t[e]=[])).push(n)},fire:function(e){var n,t,r,o,i,u=[];for(n=slice$.call(arguments,1),t=0,o=(r=this.evtHandler[e]||[]).length;t<o;++t)i=r[t],u.push(i.apply(this,n));return u},init:function(){var e,n,t=this;return e=this.lc,this.lc.view=n=new ldView({root:this.root,action:{click:{upload:function(e){return e.node,e.evt,t.upload().then(function(e){return t.clear(),e})},clear:function(e){return e.node,e.evt,t.clear()},check:function(n){var t;return n.node,n.evt,t=new FormData,e.files.map(function(e){return t.append("file",e.file)}),t.append("test",123),console.log(typeof t,t instanceof FormData)}},drop:{drop:function(t){var r,o;return t.node,(r=t.evt).preventDefault(),o=Array.from(r.dataTransfer.files).map(function(e){return ldFile.fromFile(e,"dataurl","utf-8")}),Promise.all(o).then(function(t){return e.files=t,n.render(),uploads({files:e.files,progress:function(e){return console.log(e)}})})}},dragover:{drop:function(e){return e.node,e.evt.preventDefault()}}},handler:{file:{list:function(){return e.files||[]},handle:function(n){var t,r;return t=n.node,r=n.data,new ldView({root:t,action:{click:{delete:function(){var n;if(t.parentNode.removeChild(t),(n=e.files.indexOf(r))>=0)return e.files.splice(n,1)}}},handler:{name:function(e){var n;return n=e.node,n.textContent=r.file.name},size:function(e){var n;return n=e.node,n.textContent=Math.round(r.file.size/1024)+"KB"},thumb:function(e){var n;return n=e.node,n.style.backgroundImage="url("+r.result+")"}}})}},input:function(t){var r,o;return r=t.node,e.ldf=o=new ldFile({root:r,type:"dataurl",forceEncoding:"utf-8"}),o.on("load",function(t){var r,o;return r=n.get("preview"),o=t.map(function(e){return new Promise(function(n,o){var i;return i=new Image,i.onload=function(){var o,u;return r&&((o=r.style).backgroundImage="url("+t[0].result+")",o.width=i.width+"px",o.height=i.height+"px"),n(import$((u={},u.width=i.width,u.height=i.height,u),e))},i.src=e.result})}),Promise.all(o).then(function(){return e.files=t,n.render()})})}}})},get:function(){return this.lc.files},clear:function(){return this.lc.files.splice(0),this.lc.view.render()},upload:function(){var e=this;return t[this.ucfg.host]({files:this.lc.files,progress:this.progress,opt:this.ucfg}).then(function(n){return e.fire("upload.done",n),n}).catch(function(n){return e.fire("upload.fail",n),Promise.reject(n)})}}),t={},t.dummy=function(e){var n;return n=e.files,e.progress,e.opt,new Promise(function(e,t){return e(n.map(function(e){return{url:"https://i.ibb.co/frf90x6/only-support.png",name:e.file.name}}))})},t.native=function(n){var t,r,o;return t=n.files,r=n.progress,o=n.opt,new Promise(function(n,i){var u,a,l,s,c,f,p;return u=o||{},a=u.merge,l=u.route,r({percent:0,val:0,len:f}),a?(s=new FormData,t.map(function(e){return s.append("file",e.file)}),e(l,{method:"POST",body:s},{type:"json"}).then(n).catch(i)):(c=[],f=t.length,(p=function(t){var o,i;return(o=t.splice(0,1)[0])?((i=new FormData).append("file",o.file),e(l,{method:"POST",body:i},{type:"json",progress:r}).then(function(e){var n;return c.push(n=e[0]),r({percent:(f-t.length)/f,val:f-t.length,len:f,item:n}),p(t)}).catch(function(e){var n;return c.push(n={name:o.file.name,error:e}),r({percent:(f-t.length)/f,val:f-t.length,len:f,item:n})})):n(c)})(t))})},t.imgbb=function(n){var t,r,o;return t=n.files,r=n.progress,o=n.opt,new Promise(function(n,i){var u,a,l;return u=[],a=t.length,r({percent:0,val:0,len:a}),(l=function(t){var i,s;return(i=t.splice(0,1)[0])?((s=new FormData).append("image",i.file),e("https://api.imgbb.com/1/upload?key="+o.key,{method:"POST",body:s},{type:"json"}).then(function(e){var n;return e&&e.data&&200===e.status?(u.push(n={url:e.data.display_url,name:i.file.name,id:e.data.id,raw:e.data}),r({percent:(a-t.length)/a,val:a-t.length,len:a,item:n}),l(t)):Promise.reject(e)}).catch(function(e){var n;return u.push(n={name:i.file.name,error:e}),r({percent:(a-t.length)/a,val:a-t.length,len:a,item:n})})):n(u)})(t)})},"undefined"!=typeof module&&null!==module&&(module.exports=n),"undefined"!=typeof window&&null!==window)window.uploadr=n}();